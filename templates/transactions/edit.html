{% extends "base.html" %}

{% block title %}Edit Transaction - Self-Focus{% endblock %}

{% block content %}
<div class="d-flex justify-between align-center mb-4">
    <div>
        <h1 class="text-2xl font-bold">Edit Transaction</h1>
        <p class="text-gray-600">Update transaction details</p>
    </div>
    <a href="{{ url_for('transactions.list_transactions') }}" class="btn btn-outline">Back to Transactions</a>
</div>

<div class="row">
    <div class="col-8">
        <div class="card">
            <form method="POST">
                {{ form.hidden_tag() }}
                
                <div class="form-group">
                    {{ form.type.label(class="form-label") }}
                    {{ form.type(class="form-control form-select", id="transaction-type") }}
                    {% if form.type.errors %}
                        {% for error in form.type.errors %}
                            <small style="color: #ef4444;">{{ error }}</small>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="form-group">
                    {{ form.amount.label(class="form-label") }}
                    <div style="position: relative;">
                        <span style="position: absolute; left: 0.75rem; top: 50%; transform: translateY(-50%); color: #6b7280;">$</span>
                        {{ form.amount(class="form-control", style="padding-left: 2rem;", step="0.01", min="0.01") }}
                    </div>
                    {% if form.amount.errors %}
                        {% for error in form.amount.errors %}
                            <small style="color: #ef4444;">{{ error }}</small>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="form-group">
                    {{ form.category_id.label(class="form-label") }}
                    {{ form.category_id(class="form-control form-select") }}
                    {% if form.category_id.errors %}
                        {% for error in form.category_id.errors %}
                            <small style="color: #ef4444;">{{ error }}</small>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="form-group">
                    {{ form.description.label(class="form-label") }}
                    {{ form.description(class="form-control") }}
                    {% if form.description.errors %}
                        {% for error in form.description.errors %}
                            <small style="color: #ef4444;">{{ error }}</small>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="form-group">
                    {{ form.transaction_date.label(class="form-label") }}
                    {{ form.transaction_date(class="form-control") }}
                    {% if form.transaction_date.errors %}
                        {% for error in form.transaction_date.errors %}
                            <small style="color: #ef4444;">{{ error }}</small>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="form-group">
                    {{ form.receipt_url.label(class="form-label") }}
                    {{ form.receipt_url(class="form-control", placeholder="https://example.com/receipt.jpg") }}
                    {% if form.receipt_url.errors %}
                        {% for error in form.receipt_url.errors %}
                            <small style="color: #ef4444;">{{ error }}</small>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="d-flex gap-3">
                    <button type="submit" class="btn btn-primary">Update Transaction</button>
                    <a href="{{ url_for('transactions.list_transactions') }}" class="btn btn-outline">Cancel</a>
                    <button type="button" onclick="deleteTransaction('{{ transaction.id }}')" class="btn btn-danger">Delete Transaction</button>
                </div>
            </form>
        </div>
    </div>
    
    <div class="col-4">
        <div class="card">
            <h3 class="card-title">Transaction Info</h3>
            <div class="text-sm text-gray-600">
                <div class="mb-2">
                    <strong>Created:</strong> {{ transaction.created_at.strftime('%Y-%m-%d %H:%M') }}
                </div>
                <div class="mb-2">
                    <strong>Original Amount:</strong> 
                    <span style="color: {{ '#10b981' if transaction.type.value == 'Income' else '#ef4444' }};">
                        {{ '+' if transaction.type.value == 'Income' else '-' }}${{ "%.2f"|format(transaction.amount) }}
                    </span>
                </div>
                <div class="mb-2">
                    <strong>Category:</strong> {{ transaction.category.icon }} {{ transaction.category.name }}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
async function deleteTransaction(transactionId) {
    if (!confirm('Are you sure you want to delete this transaction? This action cannot be undone.')) {
        return;
    }
    
    try {
        const response = await fetch(`/transactions/${transactionId}/delete`, {
            method: 'POST'
        });
        
        if (response.ok) {
            SelfFocus.showAlert('success', 'Transaction deleted successfully');
            window.location.href = '{{ url_for("transactions.list_transactions") }}';
        } else {
            throw new Error('Failed to delete transaction');
        }
    } catch (error) {
        SelfFocus.showAlert('error', error.message || 'Failed to delete transaction');
    }
}
</script>
{% endblock %}